<%- include ./header.ejs%>

<% _.each(products,function (items) { %>
<div class="card mb-3 cardSubC shadow  bg-white rounded" style="max-width: 1200px; margin-top: 50px">
    <div class="row no-gutters">
        <div class="col-md-4">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="\images\<%=items.image_groups[0].images[0].link%>" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="\images\<%=items.image_groups[0].images[0].link%>" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="\images\<%=items.image_groups[0].images[0].link%>" class="d-block w-100" alt="...">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>


        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h5 class="card-title"><%= items.name%></h5>
                <p class="card-text"><%= items.page_description%></p>
                <%if(items.long_description != items.page_description){%>
                <%- items.long_description%>
                <%}%>
                    <div class="container">
                    <div class="row ">
                        <div class="row">
                        <div class=" col-md-8 ">
                            <h6 style="text-align: center; display: inline">Color:</h6>
                            <% if(items.variation_attributes[0]){%>
                                <select name="" id="">
                                <% _.each(items.variation_attributes[0].values,function (items) { %>
                            <option value="<%= items.value%>"> <%=items.name%></option>
                                <%})%>
                                </select>
                            <%}%>
                        </div>
                            <% if(items.variation_attributes[1]){%>


                            <div class=" col-md " >
                                <h6>Size:</h6>
                                <select >
                                    <% _.each(items.variation_attributes[1].values,function (items) { %>
                                    <option value="<%= items.value%>"><%=items.name%></option>
                                    <%})%>
                                </select>

                                <%}%>

                            </div>


                            <% if(items.variation_attributes[2]){%>

                            <div class=" col-md-8  ">
                                <h6>Width:</h6>
                                <% _.each(items.variation_attributes[2].values,function (items) { %>

                                <a  href="" class="btn btn-info btn-md"><%=items.name%></a>
                                <%})%>
                                <%}%>
                            </div>
                        </div>

                    </div>

                <div class="container " style="margin-top: 20px">

                    <div class="row ">

                        <div class="prdbtn col-">
                            <a class="btn btn-success btn-block ">Buy</a>
                        </div>
                        <div class="prdbtn col- ">
                            <a class="btn btn-danger btn-block ">Add to wishlist</a>
                        </div>
                        <div class="prdbtn col- border">
                            <span  id="price"  style="padding: 5px;font-size:20px;"><%= items.price%></span>
                        </div>


                        <select class="prdbtn" name="currency" id="currency">
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="UAH">UAH</option>
                        </select>
                        <span id="textbox"></span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>

<script>

    function isEmpty(obj) {
        for(var key in obj) {
            if(obj.hasOwnProperty(key))
                return false;
        }
        return true;
    }

    $(document).ready(function($){

        url= '/test/currency?q=<%=items.price%>'
        $("#currency").change(function(){
            var selectedCurrency = $(this).children("option:selected").val();
           var  data = {currency: selectedCurrency}
            var callback = function(res){
                var s = Object.values(res)[0];
                var price = Object.values(res)[1];

               var  c = price * s;

               $("#price").text(Math.round(c * 100) / 100);

            };
            $.post(url,data,callback);
        });
    });
</script>


<% }) %>